<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Assignment 2</title>
        <script type="text/javascript" src="d3.js"></script>
    </head>
    <body>
        <div id="title">
        <h1>Assignment 2</h1>
        </div>
        <div id="A">
        <h2>Assignment 2A: Simple SVG stuff</h2>
        <script type="text/javascript">
		
			var dataset = [ 5, 10, 15, 20, 25 ];
			
			d3.select("#A").selectAll("p")
				.data(dataset)
				.enter()
				.append("p")
                .style("font-family", "sans-serif")
                .style("font-size", "24px")
                .style("font-weight", "bold")
				.text(function(d) {
					return "I can count up to " + d;
				})
				.style("color", function(d) {
					if (d > 15) {
						return "red";
					} else {
						return "black";
					}
				});
			
		</script>
        <svg width="500" height="150">
    <rect x="0" y="60" width="80" height="80" fill="purple" stroke = "gray" stroke-width="2"/>
    <rect x="50" y="45" width="80" height="80" fill="blue" stroke = "gray" stroke-width="2" opacity="0.8"/>
    <rect x="100" y="30" width="80" height="80" fill="green" stroke = "gray" stroke-width="2" opacity="0.6"/>
    <rect x="150" y="15" width="80" height="80" fill="yellow" stroke = "gray" stroke-width="2" opacity="0.4"/>
    <rect x="200" y="0" width="80" height="80" fill="red" stroke = "gray" stroke-width="2" opacity="0.2"/>
    </svg>
    
    </div>
    <div id="B">
    <h2>Assignment 2B: One scatter plot and two datasets</h2>
    <p>Explain in your own words why you think I want the axes to be the same for both years?</p>
    <p>Keeping the axes unchanged allows the user to see the change between years. If the axes would change the transition would not correspond to the difference in the data.</p>
    <p id="onPlot">The data from 2003 is visible on the scatter plot</p>
    <script type="text/javascript">


     /*   d3.csv("CrimeData.csv", function(error, data) {

            if (error) {  //If error is not null, something went wrong.
                console.log(error);  //Log the error.
            } else {      //The file loaded correctly
                dataSet = d3.csv.parseRows(_data);
                console.log(_data);
                console.log(scatterdata);
            }

});*/
        var yScale;
        var scatterdata;
        var padding = 20;
        var svg;
        d3.text('CrimeData.csv', function(error, _data){
            if (error) {  //If error is not null, something went wrong.
                console.log(error);  //Log the error.
            } 
            else {      //The file loaded correctly
                var scatterdata = d3.csv.parseRows(_data);
                console.log(_data);
                console.log(scatterdata);
            }
        
                var w = 500;
                var h = 500;
                var twenty15 = false;
                
                var xScale = d3.scale.linear()
								 .domain([0, d3.max(scatterdata, function(d) { return d[2]; })])
								 .range([padding*4, 500-padding*4]);

                yScale = d3.scale.linear()
								 .domain([0, 2319])
								 .range([500-padding*4,padding*4]);
                
                var radScale = d3.scale.linear()
								 .domain([0, d3.max(scatterdata, function(d) { return d[1]; })])
								 .range([2, 5]);
                
                var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom")
							  .ticks(5);

			     //Define Y axis
			     var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(5);

                //Create SVG element
                svg = d3.select("#B")
                            .append("svg")
                            .attr("width", w)
                            .attr("height", h);

                svg.selectAll("circle")
                   .data(scatterdata)
                   .enter()
                   .append("circle")
                   .attr("cx", function(d) {
                        return xScale(d[2]);
                   })
                   .attr("cy", function(d) {
                        return yScale(d[3]);
                   })
                   .attr("r", function(d) {
                        return radScale(d[1]);
                   });

                svg.selectAll("text")
                   .data(scatterdata)
                   .enter()
                   .append("text")
                   .text(function(d) {
                        return d[0];
                   })
                   .attr("x", function(d) {
                        return xScale(d[2]);
                   })
                   .attr("y", function(d) {
                        return yScale(d[3]);
                   })
                   .attr("font-family", "sans-serif")
                   .attr("font-size", "11px")
                   .attr("fill", "red");

                svg.append("g")
                        .attr("class", "axis")
                        .attr("transform", "translate(0," + (h - padding*4) + ")")
                        .call(xAxis);

//Create Y axis
                svg.append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(" + padding*4 + ",0)")
                    .call(yAxis);
//On click
                d3.select("#year")
                    .on("click", function() {
                    if(twenty15){
                        twenty15 = false;
                    }
                    else{
                        twenty15 = true;
                    }
                    if(!twenty15){
                        d3.select("#onPlot").text("The data from 2003 is visible on the scatter plot");
                        d3.select("#year").text("Click here to see the data from 2015");
                        
                        svg.selectAll("circle")
                            .data(scatterdata)
                            .transition()
                            .duration(1500)
                            .attr("cx", function(d) {
                                 return xScale(d[2]);
                            })
                            .attr("cy", function(d) {
                                 return yScale(d[3]);
                            })
                            .attr("r", function(d) {
                                 return radScale(d[1]);
                            });

                        svg.selectAll("text")
                            .data(scatterdata)
                            .transition()
                            .duration(1500)
                            .text(function(d) {
                                 return d[0];
                            })
                            .attr("x", function(d) {
                                 return xScale(d[2]);
                            })
                            .attr("y", function(d) {
                                 return yScale(d[3]);
                            })
                            .attr("font-family", "sans-serif")
                            .attr("font-size", "11px")
                            .attr("fill", "red");
                    }
                    if(twenty15){
                        d3.select("#onPlot").text("The data from 2015 is visible on the scatter plot");
                        d3.select("#year").text("Click here to see the data from 2003");
                        svg.selectAll("circle")
                            .data(scatterdata)
                            .transition()
                            .duration(1500)
                            .attr("cx", function(d) {
                                 return xScale(d[5]);
                            })
                            .attr("cy", function(d) {
                                 return yScale(d[6]);
                            })
                            .attr("r", function(d) {
                                 return radScale(d[4]);
                            });

                        svg.selectAll("text")
                            .data(scatterdata)
                            .transition()
                            .duration(1500)
                            .text(function(d) {
                                 return d[0];
                            })
                            .attr("x", function(d) {
                                 return xScale(d[5]);
                            })
                            .attr("y", function(d) {
                                 return yScale(d[6]);
                            })
                            .attr("font-family", "sans-serif")
                            .attr("font-size", "11px")
                            .attr("fill", "red");
                    }
                }); 
        });
    </script>
        <p id="year">Click here to see the data from 2015</p>
        </div>
        <div id="C">
            <h2>Assignment 2C: One barchart and (at least) two datasets</h2>
            <p id="onHistogram">The data prostitution crimes is visible on the histogram.</p>
            
        <script type="text/javascript">

			//Width and height
			var w = 600;
			var h = 250;
            var padding = 20;
            var colorScale;
            disConduct = false;
            d3.text('DisorderlyConduct.csv', function(error, _data){
                if (error) {  //If error is not null, something went wrong.
                    console.log(error);  //Log the error.
                } 
                else {      //The file loaded correctly
                    disorderlyConductData = d3.csv.parseRows(_data);
                    console.log(_data);
                    console.log(dataset);
                }
            });
            d3.text('Prostitution.csv', function(error, _data){
            if (error) {  //If error is not null, something went wrong.
                console.log(error);  //Log the error.
            } 
            else {      //The file loaded correctly
                prostitutionData = d3.csv.parseRows(_data);
                console.log(_data);
                console.log(dataset);
            }
            dataset = prostitutionData;
			var xScale = d3.scale.ordinal()
							.domain(d3.range(dataset.length))
							.rangeRoundBands([padding, w-padding], 0.05);

			var yScale = d3.scale.linear()
				            .domain([0, 2000])
							.range([padding, h-padding]);
            colorScale = d3.scale.linear()
                            .domain([0,2000])
                            .range([0,255]);
			console.log(d3.min(dataset, function(d) { return d[1]; }));
			//Create SVG element
			var svg = d3.select("#C")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

			//Create bars
			svg.selectAll("rect")
			   .data(dataset)
			   .enter()
			   .append("rect")
			   .attr("x", function(d, i) {
			   		return xScale(i);
			   })
			   .attr("y", function(d) {
			   		return h-padding - yScale(d[1]);
			   })
			   .attr("width", xScale.rangeBand())
			   .attr("height", function(d) {
			   		return yScale(d[1]);
			   })
			   .attr("fill", function(d) {
							return "rgb(0, 0, " + (d[1] * 10) + ")";
				});

			//Create labels
			svg.selectAll("text")
			   .data(dataset)
			   .enter()
			   .append("text")
			   .text(function(d) {
			   		return d[1];
			   })
			   .attr("text-anchor", "middle")
			   .attr("x", function(d, i) {
			   		return xScale(i) + xScale.rangeBand() / 2;
			   })
			   .attr("y", function(d) {
			   		return h -padding - yScale(d[1]) + 14;
			   })
			   .attr("font-family", "sans-serif")
			   .attr("font-size", "11px")
			   .attr("fill", "white");
            
            
            var x = d3.scale.linear()
                    .domain([2003, 2015])
                    .range([0, w-padding*3]);
                    

            var xAxis = d3.svg.axis()
                    .scale(x)
                    .orient("bottom")
                    .ticks(7)
                    .tickFormat(d3.format("d"));
            
            svg.append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(30," + (h - padding) + ")")
                    .call(xAxis);

			//On click, update with new data			
			d3.select("#changeHistogram")
				.on("click", function() {
					//Update all rects
                    if(disConduct){
                        d3.select("#onHistogram").text("The data for prostitution crimes is visible on the histogram.");
                        d3.select("#changeHistogram").text("Click here to see the data for disorderly conduct crimes!");
                        dataset = prostitutionData;
                        disConduct = false;
                    }
                    else{
                         d3.select("#onHistogram").text("The data for disorderly conduct crimes is visible on the histogram.");
                        d3.select("#changeHistogram").text("Click here to see the data for prostitution crimes!");
                        dataset = disorderlyConductData;
                        disConduct = true;
                    }
					svg.selectAll("rect")
					   .data(dataset)
					   .transition()
					   .delay(function(d, i) {
						   return i / dataset.length * 1000;
					   })
					   .duration(500)
					   .attr("y", function(d) {
					   		return h - padding- yScale(d[1]);
					   })
					   .attr("height", function(d) {
					   		return yScale(d[1]);
					   })
					   .attr("fill", function(d) {
							return "rgb(0, 0, " + (d[1] * 10) + ")";
					   });

					//Update all labels
					svg.selectAll("text")
					   .data(dataset)
					   .transition()
					   .delay(function(d, i) {
						   return i / dataset.length * 1000;
					   })
					   .duration(500)
					   .text(function(d) {
					   		return d[1];
					   })
					   .attr("x", function(d, i) {
					   		return xScale(i) + xScale.rangeBand() / 2;
					   })
					   .attr("y", function(d) {
					   		return h - padding - yScale(d[1]) + 14;
					   });
                });
        });
		</script>
            <p id="changeHistogram">Click here to see the data for disorderly conduct crimes!</p>
        </div>
        <div id="D">
        <h2>Assignment 2D: Visualizing geodata</h2>
            <p>Why is the size of the file important?</p>
            <p>If the file is large it would take longer to load the webpage which is tedious for the user. The code is not excecuted until the data is loded so the user wont be able to see the map until the file is loaded.</p>
        <script type="text/javascript">
//Width and height
			var w = 500;
			var h = 300;
			//Define map projection
            

            var lattop = -122.511421514;
            var lonleft = 37.8199754923;
            var lonright = 37.7081535998;
            var width = 500;
            var height =300;
            var xym = d3.geo.mercator().scale(40200).translate([86000,28800]);
            // make the scale so that the difference of longitude is 
            // exactly the width of the image
            //var scale = 360*width/(lonright-lonleft);
            //xym.scale(1000);

            // translate the origin of the map to [0,0] as a start, 
            // not to the now meaningless default of [480,250]
           

			//Define path generator
			var path = d3.geo.path().projection(xym);
			//Create SVG element
			var svgg = d3.select("#D")
						.append("svg")
						.attr("width", width)
						.attr("height", height);
			//Load in GeoJSON data
			d3.json("sfpddistricts.geojson", function(json) {
				
				//Bind data and create one path per GeoJSON feature
				svgg.selectAll("path")
				   .data(json.features)
				   .enter()
				   .append("path")
				   .attr("d", path);
		
			});
			
        </script>
        </div>
    </body>
</html>